import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';

type Lang = 'en' | 'ru' | 'kz';

const TRANSLATIONS: Record<Lang, Record<string, string>> = {
  en: {
    home: 'Home',
    about: 'About',
    items: 'Items',
    profile: 'Profile',
    favorites: 'Favorites',
    login: 'Login',
    signup: 'Signup',
    logout: 'Logout',
    offline: 'You are offline',
    enablePush: 'Notifications',
    offlineBanner: 'You are currently offline. Some features may not be available.',
    offlineTitle: 'Offline',
    offlineMessage: 'You are currently offline. Some features may be unavailable.',
    offlineCached: 'Cached pages and assets are available.',
    offlineFavorites: 'Favorites in local mode continue to work.',
    offlineSearch: 'Search/API calls will retry when online.',
    homeWelcome: 'Welcome',
    homeItemsLink: 'Go to Items',
    homeAboutLink: 'About Us',
    homeImageAlt: 'Home Image',
    aboutTitle: 'About This Project',
    aboutDescription: 'This Akzhols Market demonstrates an Angular 17 project using standalone components, server-side search, and routing.',
    aboutBullet1: 'Angular 17 (Standalone Components)',
    aboutBullet2: 'Router & Navigation',
    aboutBullet3: 'Server-side search with query parameters',
    aboutBullet4: 'Item details view',
    aboutBullet5: 'Responsive CSS Grid layout',
    aboutCredit: 'Developed by Akzhol Sadyk as a HomeWork#6 project.',
    favoritesTitle: 'My Favorites',
    loadingFavorites: 'Loading favorites...',
    errorLoadingFavorites: 'Error loading favorites:',
    noFavorites: 'You have no items in your favorites list.',
    details: 'Details',
    loadingItems: 'Loading items...',
    errorLoadingItems: 'Error loading items:',
    searchPlaceholder: 'Search...',
    itemsPerPage: 'Items per page:',
    previous: 'Previous',
    next: 'Next',
    showFilters: 'Show Filters',
    hideFilters: 'Hide Filters',
    filters: 'Filters',
    clearFilters: 'Clear Filters',
    category: 'Category',
    brand: 'Brand',
    minPrice: 'Min Price',
    maxPrice: 'Max Price',
    minRating: 'Min Rating',
    allCategories: 'All Categories',
    allBrands: 'All Brands',
    showingResults: 'Showing',
    noItemsFound: 'No items found',
    loadingItem: 'Loading item...',
    errorLoadingItem: 'Error loading item:',
    back: 'Back',
    addToFavorites: 'Add to favorites',
    removeFromFavorites: 'Remove from favorites',
    addToFavoritesLong: 'Add to Favorites',
    removeFromFavoritesLong: 'Remove from Favorites',
    description: 'Description:',
    price: 'Price:',
    rating: 'Rating:',
    reviewsCount: 'Reviews Count:',
    id: 'ID:',
    profileTitle: 'Profile',
    email: 'Email:',
    uid: 'UID:',
    loadingProfile: 'Loading user info...',
    profilePhoto: 'Profile photo',
    uploadPhoto: 'Upload photo',
    uploadingPhoto: 'Uploading...',
    password: 'Password',
    emailPlaceholder: 'Email',
    passwordPlaceholder: 'Password',
    repeatPasswordPlaceholder: 'Repeat Password',
    loginTitle: 'Login',
    signupTitle: 'Signup',
    signingUp: 'Signing up...',
    signupButton: 'Signup',
    emailRequired: 'Email is required.',
    emailInvalid: 'Email must be a valid email address.',
    passwordRequired: 'Password is required.',
    passwordCriteria: 'Password must meet the following criteria:',
    passwordMin: 'Minimum 8 characters',
    passwordNumber: 'At least one number',
    passwordSpecial: 'At least one special character',
    repeatPasswordRequired: 'Repeat Password is required.',
    passwordsMustMatch: 'Passwords must match.'
  },
  ru: {
    home: 'Главная',
    about: 'О нас',
    items: 'Товары',
    profile: 'Профиль',
    favorites: 'Избранное',
    login: 'Войти',
    signup: 'Регистрация',
    logout: 'Выйти',
    offline: 'Вы офлайн',
    enablePush: 'Уведомления',
    offlineBanner: 'Вы сейчас офлайн. Некоторые функции могут быть недоступны.',
    offlineTitle: 'Офлайн',
    offlineMessage: 'Вы сейчас офлайн. Некоторые функции могут быть недоступны.',
    offlineCached: 'Кэшированные страницы и ресурсы доступны.',
    offlineFavorites: 'Избранное в локальном режиме продолжает работать.',
    offlineSearch: 'Поиск/запросы повторятся при появлении сети.',
    homeWelcome: 'Добро пожаловать',
    homeItemsLink: 'Перейти к товарам',
    homeAboutLink: 'О нас',
    homeImageAlt: 'Главное изображение',
    aboutTitle: 'О проекте',
    aboutDescription: 'Akzhols Market демонстрирует проект Angular 17 со standalone компонентами, серверным поиском и роутингом.',
    aboutBullet1: 'Angular 17 (Standalone Components)',
    aboutBullet2: 'Роутер и навигация',
    aboutBullet3: 'Серверный поиск с query-параметрами',
    aboutBullet4: 'Страница деталей товара',
    aboutBullet5: 'Адаптивная сетка CSS Grid',
    aboutCredit: 'Разработал Акжол Садык как проект HomeWork#6.',
    favoritesTitle: 'Мои избранные',
    loadingFavorites: 'Загрузка избранного...',
    errorLoadingFavorites: 'Ошибка загрузки избранного:',
    noFavorites: 'В вашем списке избранного нет товаров.',
    details: 'Подробнее',
    loadingItems: 'Загрузка товаров...',
    errorLoadingItems: 'Ошибка загрузки товаров:',
    searchPlaceholder: 'Поиск...',
    itemsPerPage: 'Товаров на странице:',
    previous: 'Предыдущая',
    next: 'Следующая',
    loadingItem: 'Загрузка товара...',
    errorLoadingItem: 'Ошибка загрузки товара:',
    back: 'Назад',
    addToFavorites: 'Добавить в избранное',
    removeFromFavorites: 'Убрать из избранного',
    addToFavoritesLong: 'Добавить в избранное',
    removeFromFavoritesLong: 'Убрать из избранного',
    description: 'Описание:',
    price: 'Цена:',
    rating: 'Рейтинг:',
    reviewsCount: 'Количество отзывов:',
    id: 'ID:',
    profileTitle: 'Профиль',
    email: 'Email:',
    uid: 'UID:',
    loadingProfile: 'Загрузка информации о пользователе...',
    profilePhoto: 'Фото профиля',
    uploadPhoto: 'Загрузить фото',
    uploadingPhoto: 'Загрузка...',
    password: 'Пароль',
    emailPlaceholder: 'Email',
    passwordPlaceholder: 'Пароль',
    repeatPasswordPlaceholder: 'Повторите пароль',
    loginTitle: 'Вход',
    signupTitle: 'Регистрация',
    signingUp: 'Регистрация...',
    signupButton: 'Регистрация',
    emailRequired: 'Email обязателен.',
    emailInvalid: 'Email должен быть валидным адресом.',
    passwordRequired: 'Пароль обязателен.',
    passwordCriteria: 'Пароль должен соответствовать требованиям:',
    passwordMin: 'Минимум 8 символов',
    passwordNumber: 'Хотя бы одна цифра',
    passwordSpecial: 'Хотя бы один спецсимвол',
    repeatPasswordRequired: 'Повтор пароля обязателен.',
    passwordsMustMatch: 'Пароли должны совпадать.'
  },
  kz: {
    home: 'Басты бет',
    about: 'Біз туралы',
    items: 'Тауарлар',
    profile: 'Профиль',
    favorites: 'Таңдаулылар',
    login: 'Кіру',
    signup: 'Тіркелу',
    logout: 'Шығу',
    offline: 'Сіз офлайнсыз',
    enablePush: 'Хабарламалар',
    offlineBanner: 'Қазір офлайнсыз. Кейбір мүмкіндіктер қолжетімсіз болуы мүмкін.',
    offlineTitle: 'Офлайн',
    offlineMessage: 'Қазір офлайнсыз. Кейбір мүмкіндіктер қолжетімсіз болуы мүмкін.',
    offlineCached: 'Кэшке жазылған беттер мен ресурстар қолжетімді.',
    offlineFavorites: 'Таңдаулылар жергілікті режимде жұмысын жалғастырады.',
    offlineSearch: 'Іздеу/сұраулар желіге қосылғанда қайталанады.',
    homeWelcome: 'Қош келдіңіз',
    homeItemsLink: 'Тауарларға өту',
    homeAboutLink: 'Біз туралы',
    homeImageAlt: 'Басты сурет',
    aboutTitle: 'Жоба туралы',
    aboutDescription: 'Akzhols Market Angular 17 жобасын standalone компоненттермен, серверлік іздеумен және роутингпен көрсетеді.',
    aboutBullet1: 'Angular 17 (Standalone Components)',
    aboutBullet2: 'Роутер және навигация',
    aboutBullet3: 'Query-параметрлермен серверлік іздеу',
    aboutBullet4: 'Тауардың толық беті',
    aboutBullet5: 'Бейімделгіш CSS Grid торы',
    aboutCredit: 'Akzhol Sadyk әзірлеген, HomeWork#6 жобасы.',
    favoritesTitle: 'Менің таңдаулыларым',
    loadingFavorites: 'Таңдаулылар жүктелуде...',
    errorLoadingFavorites: 'Таңдаулыларды жүктеу қатесі:',
    noFavorites: 'Таңдаулылар тізімінде тауар жоқ.',
    details: 'Толығырақ',
    loadingItems: 'Тауарлар жүктелуде...',
    errorLoadingItems: 'Тауарларды жүктеу қатесі:',
    searchPlaceholder: 'Іздеу...',
    itemsPerPage: 'Беттегі тауар саны:',
    previous: 'Алдыңғы',
    next: 'Келесі',
    showFilters: 'Сүзгілерді көрсету',
    hideFilters: 'Сүзгілерді жасыру',
    filters: 'Сүзгілер',
    clearFilters: 'Сүзгілерді тазалау',
    category: 'Категория',
    brand: 'Бренд',
    minPrice: 'Мин. баға',
    maxPrice: 'Макс. баға',
    minRating: 'Мин. рейтинг',
    allCategories: 'Барлық категориялар',
    allBrands: 'Барлық брендтер',
    showingResults: 'Көрсетілген',
    noItemsFound: 'Тауарлар табылмады',
    loadingItem: 'Тауар жүктелуде...',
    errorLoadingItem: 'Тауарды жүктеу қатесі:',
    back: 'Артқа',
    addToFavorites: 'Таңдаулыларға қосу',
    removeFromFavorites: 'Таңдаулылардан алу',
    addToFavoritesLong: 'Таңдаулыларға қосу',
    removeFromFavoritesLong: 'Таңдаулылардан алу',
    description: 'Сипаттама:',
    price: 'Бағасы:',
    rating: 'Рейтинг:',
    reviewsCount: 'Пікірлер саны:',
    id: 'ID:',
    profileTitle: 'Профиль',
    email: 'Email:',
    uid: 'UID:',
    loadingProfile: 'Пайдаланушы мәліметі жүктелуде...',
    profilePhoto: 'Профиль фотосы',
    uploadPhoto: 'Фото жүктеу',
    uploadingPhoto: 'Жүктелуде...',
    password: 'Құпиясөз',
    emailPlaceholder: 'Email',
    passwordPlaceholder: 'Құпиясөз',
    repeatPasswordPlaceholder: 'Құпиясөзді қайталаңыз',
    loginTitle: 'Кіру',
    signupTitle: 'Тіркелу',
    signingUp: 'Тіркелуде...',
    signupButton: 'Тіркелу',
    emailRequired: 'Email міндетті.',
    emailInvalid: 'Email дұрыс болуы керек.',
    passwordRequired: 'Құпиясөз міндетті.',
    passwordCriteria: 'Құпиясөз келесі талаптарға сай болуы керек:',
    passwordMin: 'Кемі 8 таңба',
    passwordNumber: 'Кемі бір сан',
    passwordSpecial: 'Кемі бір арнайы таңба',
    repeatPasswordRequired: 'Құпиясөзді қайталау міндетті.',
    passwordsMustMatch: 'Құпиясөздер сәйкес болуы керек.'
  }
};

@Injectable({ providedIn: 'root' })
export class I18nService {
  private lang$ = new BehaviorSubject<Lang>(this.loadLang());

  get currentLang$() {
    return this.lang$.asObservable();
  }

  setLang(lang: Lang) {
    this.lang$.next(lang);
    localStorage.setItem('lang', lang);
  }

  t(key: string): string {
    const lang = this.lang$.value;
    return TRANSLATIONS[lang][key] || key;
  }

  private loadLang(): Lang {
    const stored = localStorage.getItem('lang') as Lang | null;
    if (stored && ['en','ru','kz'].includes(stored)) return stored;
    return 'en';
  }
}

