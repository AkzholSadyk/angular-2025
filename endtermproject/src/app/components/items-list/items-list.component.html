<div class="controls">
  <input (input)="onSearch($event)" [placeholder]="'searchPlaceholder' | t" />

  <button type="button" class="filter-toggle-btn" (click)="toggleFilters()">
    {{ showFilters ? ('hideFilters' | t) : ('showFilters' | t) }}
  </button>

  <label for="limit-select">{{ 'itemsPerPage' | t }}</label>
  <select id="limit-select" (change)="onLimitChange($event)" [ngModel]="currentLimit">
    <option *ngFor="let limit of limitOptions" [value]="limit">{{ limit }}</option>
  </select>
</div>

<div class="filters-panel" *ngIf="showFilters">
  <div class="filters-header">
    <h3>{{ 'filters' | t }}</h3>
    <button type="button" class="clear-filters-btn" (click)="clearFilters()">
      {{ 'clearFilters' | t }}
    </button>
  </div>

  <div class="filters-grid">
    <div class="filter-group">
      <label for="category-filter">{{ 'category' | t }}</label>
      <select 
        id="category-filter" 
        [(ngModel)]="filters.category" 
        (ngModelChange)="onFilterChange()"
      >
        <option value="">{{ 'allCategories' | t }}</option>
        <option *ngFor="let category of categories$ | async" [value]="category">
          {{ category }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label for="brand-filter">{{ 'brand' | t }}</label>
      <select 
        id="brand-filter" 
        [(ngModel)]="filters.brand" 
        (ngModelChange)="onFilterChange()"
      >
        <option value="">{{ 'allBrands' | t }}</option>
        <option *ngFor="let brand of brands$ | async" [value]="brand">
          {{ brand }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label for="min-price-filter">{{ 'minPrice' | t }}</label>
      <input 
        type="number" 
        id="min-price-filter" 
        [(ngModel)]="filters.minPrice" 
        (ngModelChange)="onFilterChange()"
        placeholder="0"
        min="0"
        step="0.01"
      />
    </div>

    <div class="filter-group">
      <label for="max-price-filter">{{ 'maxPrice' | t }}</label>
      <input 
        type="number" 
        id="max-price-filter" 
        [(ngModel)]="filters.maxPrice" 
        (ngModelChange)="onFilterChange()"
        placeholder="âˆž"
        min="0"
        step="0.01"
      />
    </div>

    <div class="filter-group">
      <label for="min-rating-filter">{{ 'minRating' | t }}</label>
      <input 
        type="number" 
        id="min-rating-filter" 
        [(ngModel)]="filters.minRating" 
        (ngModelChange)="onFilterChange()"
        placeholder="0"
        min="0"
        max="5"
        step="0.1"
      />
    </div>
  </div>
</div>

<div *ngIf="loading$ | async" class="loading">{{ 'loadingItems' | t }}</div>

<div *ngIf="(error$ | async) as err" class="error">
  {{ 'errorLoadingItems' | t }} {{ err?.message || (err | json) }}
</div>

<div *ngIf="(filteredItems$ | async) as allFilteredItems" class="results-info">
  <p>{{ 'showingResults' | t }}: {{ allFilteredItems.length }} {{ 'items' | t }}</p>
</div>

<ul *ngIf="(paginatedItems$ | async) as items">
  <li *ngFor="let item of items">
    <a [routerLink]="['/items', item.id]">
      <app-item-card [item]="item"></app-item-card>
    </a>
  </li>
</ul>

<div *ngIf="(paginatedItems$ | async)?.length === 0 && !(loading$ | async)" class="no-results">
  <p>{{ 'noItemsFound' | t }}</p>
</div>

<div class="pagination" *ngIf="totalPages > 1">
    <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
      {{ 'previous' | t }}
  </button>

  <ng-container *ngFor="let page of pages">
    <button (click)="goToPage(page)" [class.active]="page === currentPage">
      {{ page }}
    </button>
  </ng-container>

    <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
      {{ 'next' | t }}
  </button>
</div>

<style>
  .controls {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    align-items: center;
  }
  .pagination {
    display: flex;
    justify-content: center;
    margin-top: 20px;
    gap: 5px;
  }
  .pagination button {
    padding: 8px 16px;
    border: 1px solid #ccc;
    background-color: #f8f8f8;
    cursor: pointer;
  }
  .pagination button.active {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
  }
  .pagination button:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }
</style>
