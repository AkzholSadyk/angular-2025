<div class="page">
  <div class="profile-container" *ngIf="profileData$ | async as profileData; else loading">
    <h2>{{ 'profileTitle' | t }}</h2>

    <div class="avatar-block">
      <div class="avatar-wrapper">
        <img 
          class="avatar" 
          [src]="previewUrl || profileData.photoURL || 'https://via.placeholder.com/200?text=Avatar'" 
          [alt]="'profilePhoto' | t"
          [class.uploading]="uploading"
        />
        <div class="upload-overlay" *ngIf="uploading">
          <div class="spinner"></div>
        </div>
      </div>
      <div class="upload-controls">
        <label class="upload-btn" [class.disabled]="uploading">
          {{ uploading ? ('uploadingPhoto' | t) : ('uploadPhoto' | t) }}
          <input type="file" accept="image/jpeg,image/jpg,image/png,image/webp" (change)="onFileSelected($event)" [disabled]="uploading" hidden>
        </label>
        <button 
          class="remove-preview-btn" 
          *ngIf="previewUrl && !uploading" 
          (click)="removePreview()"
          type="button"
        >
          {{ 'cancel' | t }}
        </button>
        <div class="upload-error" *ngIf="uploadError">{{ uploadError }}</div>
      </div>
    </div>

    <div class="profile-info">
      <p><strong>{{ 'email' | t }}</strong> {{ profileData.email }}</p>
      <p><strong>{{ 'uid' | t }}</strong> {{ profileData.uid }}</p>
    </div>

    <button (click)="logout()">{{ 'logout' | t }}</button>
  </div>
</div>

<ng-template #loading>
  <div class="loading-container">
    <p>{{ 'loadingProfile' | t }}</p>
  </div>
</ng-template>